// Generated by purs bundle 0.11.7
var PS = {};
(function(exports) {
    "use strict";

  // module Projections

  exports.when = function(eventname) {
    return function(eventhandler){
      var obj = {};
      obj[eventname] = function(state, event) {
        return eventhandler(state)(event);
      }
      return obj;
    };
  };

  exports.whenAny = function(eventhandler) {
    return {$any : function(s,e) {
      return eventhandler(s)(e);
    }};
  };

  exports.runProjection = function(eventSource){
    return function(initialState){
      return function(options){
        return function(folder){
          var handlers = mergeObjects({$init: function(){return initialState;}},folder);
          return function() {
            if(isOption(options,exports.OutputState)){
              options({resultStreamName: options.value0})
              getEventsource(eventSource).when(handlers).outputState();
            } else {
              getEventsource(eventSource).when(handlers);
            }
          }
        }
      }
    }
  }

  var getEventsource = function (eventSource) {
    if(isEventsourcetype(eventSource, exports.FromStream)){
      return fromStream(eventSource.value0);
    } else if(isEventsourcetype(eventSource, exports.FromStreams)){
      return fromStreams(eventSource.value0);
    } else if(isEventsourcetype(eventSource, exports.ForEachInCategory)){
      return fromCategory(eventSource.value0).foreachStream();
    } else if(isEventsourcetype(eventSource, exports.FromCategory)){
      return fromCategory(eventSource.value0);
    } else if(isEventsourcetype(eventSource, exports.ForEach)){
      return fromAll().foreachStream();
    } 
    return fromAll();
  }

  var mergeObjects = function (obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname2 in obj2) { obj3[attrname2] = obj2[attrname2]; }
    return obj3;
  }

  var isEventsourcetype = function(eventsource, expectedType) {
    return eventsource !== undefined && eventsource instanceof expectedType;
  }
})(PS["Projections"] = PS["Projections"] || {});
(function(exports) {
  // Generated by purs version 0.11.7
  "use strict";
  var $foreign = PS["Projections"];
  var Control_Monad_Eff = PS["Control.Monad.Eff"];
  var Data_Semigroup = PS["Data.Semigroup"];
  var Prelude = PS["Prelude"];
  var DefaultOptions = (function () {
      function DefaultOptions() {

      };
      DefaultOptions.value = new DefaultOptions();
      return DefaultOptions;
  })();
  var FromStream = (function () {
      function FromStream(value0) {
          this.value0 = value0;
      };
      FromStream.create = function (value0) {
          return new FromStream(value0);
      };
      return FromStream;
  })();
  var FromAll = (function () {
      function FromAll() {

      };
      FromAll.value = new FromAll();
      return FromAll;
  })();
  var FromCategory = (function () {
      function FromCategory(value0) {
          this.value0 = value0;
      };
      FromCategory.create = function (value0) {
          return new FromCategory(value0);
      };
      return FromCategory;
  })();
  var FromStreams = (function () {
      function FromStreams(value0) {
          this.value0 = value0;
      };
      FromStreams.create = function (value0) {
          return new FromStreams(value0);
      };
      return FromStreams;
  })();                                                                     
  var fromStreams = function (streams) {
      return new FromStreams(streams);
  };
  var fromStream = function (streamname) {
      return new FromStream(streamname);
  };
  var fromCategory = function (category) {
      return new FromCategory(category);
  };
  var fromAll = FromAll.value;
  exports["FromStream"] = FromStream;
  exports["FromAll"] = FromAll;
  exports["FromCategory"] = FromCategory;
  exports["FromStreams"] = FromStreams;
  exports["DefaultOptions"] = DefaultOptions;
  exports["fromStream"] = fromStream;
  exports["fromAll"] = fromAll;
  exports["fromCategory"] = fromCategory;
  exports["fromStreams"] = fromStreams;
  exports["runProjection"] = $foreign.runProjection;
  exports["when"] = $foreign.when;
  exports["whenAny"] = $foreign.whenAny;
})(PS["Projections"] = PS["Projections"] || {});
(function(exports) {
  // Generated by purs version 0.11.7
  "use strict";
  var Control_Monad_Eff = PS["Control.Monad.Eff"];
  var Data_Function = PS["Data.Function"];
  var Data_Semiring = PS["Data.Semiring"];
  var Prelude = PS["Prelude"];
  var Projections = PS["Projections"];        
  var handlerB = function (s) {
      return function (e) {
          return {
              count: s.count + 1 | 0
          };
      };
  };
  var handlerA = function (s) {
      return function (e) {
          return {
              count: s.count + 1 | 0
          };
      };
  };
  var whenAnyEvent = Projections.runProjection(Projections.fromAll)({
      count: 0
  })(Projections.DefaultOptions.value)(Projections.whenAny(handlerA));
  var main = whenAnyEvent;
  var fromStreamsProjections = Projections.runProjection(Projections.fromStreams([ "$stats-127.0.0.1:2113", "$projections-$master" ]))({
      count: 0
  })(Projections.DefaultOptions.value)(Projections.when("$statsCollected")(handlerA));
  var fromStreamProjections = Projections.runProjection(Projections.fromStream("$stats-127.0.0.1:2113"))({
      count: 0
  })(Projections.DefaultOptions.value)(Projections.when("$statsCollected")(handlerA));
  var fromAllProjections = Projections.runProjection(Projections.fromAll)({
      count: 0
  })(Projections.DefaultOptions.value)(Projections.when("$statsCollected")(handlerA));
  var forEachInCategoryProjections = Projections.runProjection(Projections.fromCategory("$stats"))({
      count: 0
  })(Projections.DefaultOptions.value)(Projections.when("$statsCollected")(handlerA));
  exports["handlerA"] = handlerA;
  exports["handlerB"] = handlerB;
  exports["fromAllProjections"] = fromAllProjections;
  exports["fromStreamProjections"] = fromStreamProjections;
  exports["forEachInCategoryProjections"] = forEachInCategoryProjections;
  exports["fromStreamsProjections"] = fromStreamsProjections;
  exports["whenAnyEvent"] = whenAnyEvent;
  exports["main"] = main;
})(PS["Main"] = PS["Main"] || {});
PS["Main"].main();
